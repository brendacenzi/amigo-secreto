<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Amigo Secreto - Natalino</title>

<style>
/* ------------------------------
   ESTILO B츼SICO (TELA DE SORTEIO)
--------------------------------*/
body {
    font-family: "Segoe UI", Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background: #f3f3f3;
}

.container {
    max-width: 800px;
    margin: auto;
}

h1 {
    text-align: center;
    color: #b30000;
}

textarea, input {
    width: 100%;
    margin-top: 10px;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
}

button {
    background: #b30000;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    margin-top: 15px;
    cursor: pointer;
    width: 100%;
}

button:hover {
    background: #d40000;
}

.link-box {
    background: white;
    padding: 12px;
    margin-top: 10px;
    border-radius: 8px;
    border-left: 5px solid #b30000;
}

a {
    word-break: break-all;
}

/* -------------------------------------------------
   TELA INDIVIDUAL DO PARTICIPANTE (NATAL + RESPONSIVO)
---------------------------------------------------*/
body.reveal {
    background: url("https://img.freepik.com/vetores-gratis/design-plano-de-padrao-de-natal-com-presentes-e-visco_23-2150848749.jpg?w=740") 
                no-repeat center/cover;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
}



.card {
    background: rgba(255, 255, 255, 0.90);
    padding: 40px 30px;
    width: 90%;
    max-width: 420px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    animation: pop 0.6s ease-out;
    backdrop-filter: blur(4px);
}

@keyframes pop {
    0% { transform: scale(0.6); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

.logo {
    font-size: 60px;
    margin-bottom: 10px;
}

.card h1 {
    color: #b30000;
    margin-bottom: 10px;
}

.card p {
    font-size: 18px;
    color: #444;
}

.amigo {
    font-size: 38px;
    color: #b30000;
    font-weight: bold;
    margin-top: 15px;
}

/* RESPONSO */
@media (max-width: 480px) {
    .card { padding: 30px 20px; }
    .logo { font-size: 50px; }
    .amigo { font-size: 32px; }
}
</style>
</head>
<body>

<div class="container" id="main-page">
    <h1>游꾻 Sorteador de Amigo Secreto 游꾼</h1>

    <p><strong>Digite os participantes (um por linha):</strong></p>
    <textarea id="lista" rows="8" placeholder="Ex: Ana&#10;Bruno&#10;Carlos"></textarea>

    <h3>Regras opcionais</h3>
    <p>Formato: Nome1 -> Nome2 (um por linha)</p>
    <textarea id="regras" rows="4" placeholder="Ex: Jo칚o -> Maria"></textarea>

    <button onclick="sortear()">Gerar Sorteio</button>

    <h2>Links individuais:</h2>
    <div id="resultado"></div>
</div>

<script>
function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

function sortear() {
    const nomes = document.getElementById("lista").value
        .trim().split("\n").map(n => n.trim()).filter(n => n);

    const regrasTexto = document.getElementById("regras").value
        .trim().split("\n").filter(r => r);

    if (nomes.length < 2) {
        alert("Digite pelo menos 2 participantes.");
        return;
    }

    let regras = {};
    for (const r of regrasTexto) {
        const [a, b] = r.split("->").map(s => s.trim());
        if (!nomes.includes(a) || !nomes.includes(b)) {
            alert(`Regra inv치lida:\n${r}`);
            return;
        }
        regras[a] = b;
    }

    let tentativas = 5000;
    let pares = null;

    while (tentativas--) {
        let sorteio = [...nomes];
        shuffle(sorteio);

        let valido = true;
        let resultado = {};

        for (let i = 0; i < nomes.length; i++) {
            const pessoa = nomes[i];
            const amigo = sorteio[i];

            if (pessoa === amigo) { valido = false; break; }
            if (regras[pessoa] && regras[pessoa] !== amigo) { valido = false; break; }

            resultado[pessoa] = amigo;
        }

        if (valido) { pares = resultado; break; }
    }

    if (!pares) {
        alert("N칚o foi poss칤vel gerar um sorteio v치lido com essas regras.");
        return;
    }

    const container = document.getElementById("resultado");
    container.innerHTML = "";

    for (const nome of nomes) {
        const token = btoa(JSON.stringify({ nome, amigo: pares[nome] }));
        const link = `${location.href.split('#')[0]}#${token}`;

        const div = document.createElement("div");
        div.className = "link-box";
        div.innerHTML = `<strong>${nome}:</strong><br><a href="${link}" target="_blank">${link}</a>`;
        container.appendChild(div);
    }
}

/* ------------------------------
   TELA INDIVIDUAL DO PARTICIPANTE
--------------------------------*/
window.onload = function() {
    if (location.hash.length > 1) {
        const data = JSON.parse(atob(location.hash.substring(1)));

        document.body.classList.add("reveal");
        document.body.innerHTML = `
            <div class="card">
                <div class="logo">游꾸</div>
                <h1>Ol치, ${data.nome}!</h1>
                <p>Ho ho ho! Chegou a hora de descobrir seu Amigo Secreto...</p>
                <p>Seu sorteado foi:</p>
                <div class="amigo">游꾻 ${data.amigo} 游꾻</div>
            </div>
        `;
    }
};
</script>
</body>
</html>
